# Архитектура бота для поиска фильмов

## Основные компоненты

### 1. Обработчики команд
- **Пользовательские команды**:
  - `/start` - Приветствие и кнопка "Ввести код"
  - Обработчик кнопки "Ввести код" - Проверка заявок в каналы
  - Обработчик кнопки "Проверить заявки" - Проверка наличия заявок во все каналы
  - Обработчик ввода кода - Поиск и выдача названия фильма

- **Админские команды**:
  - `/admin` - Вход в админ-панель (доступно только администраторам)
  - `/add_movie` - Добавление нового кода и названия фильма
  - `/list_movies` - Просмотр списка всех фильмов
  - `/delete_movie` - Удаление фильма по коду
  - `/broadcast` - Отправка рассылки всем пользователям

### 2. Обработчики событий
- **chat_join_request** - Обработка заявок пользователей в каналы
  - Сохранение информации о заявке в базу данных
  - Отслеживание статуса заявок для последующей проверки

### 3. Менеджеры
- **DatabaseManager** - Управление взаимодействием с базой данных SQLite
  - Инициализация базы данных и создание таблиц
  - CRUD-операции для фильмов, пользователей и заявок
  
- **ChannelManager** - Управление проверкой заявок в каналы
  - Получение списка каналов для проверки
  - Проверка наличия заявок пользователя во все каналы

- **AdminManager** - Управление админскими функциями
  - Проверка прав администратора
  - Управление фильмами (добавление, удаление, просмотр)
  - Управление рассылкой

## Структура проекта

```
movie_bot/
├── bot.py                 # Основной файл запуска бота
├── config.py              # Конфигурация бота (токен, ID каналов и т.д.)
├── database/
│   ├── __init__.py
│   ├── db_manager.py      # Менеджер базы данных
│   └── models.py          # Модели данных
├── handlers/
│   ├── __init__.py
│   ├── admin.py           # Обработчики админских команд
│   ├── user.py            # Обработчики пользовательских команд
│   └── channel_requests.py # Обработчики заявок в каналы
├── keyboards/
│   ├── __init__.py
│   ├── admin_kb.py        # Клавиатуры для админа
│   └── user_kb.py         # Клавиатуры для пользователя
├── middlewares/
│   ├── __init__.py
│   └── admin_check.py     # Middleware для проверки прав администратора
└── utils/
    ├── __init__.py
    ├── channel_manager.py # Утилиты для работы с каналами
    └── broadcast.py       # Утилиты для рассылки
```

## Алгоритм работы бота

1. Пользователь запускает бота командой `/start`
2. Бот отправляет приветственное сообщение с кнопкой "Ввести код"
3. Пользователь нажимает кнопку "Ввести код"
4. Бот проверяет, есть ли у пользователя заявки во все необходимые каналы
   - Если нет, предлагает подписаться и показывает кнопку "Проверить заявки"
   - Если да, предлагает ввести код фильма
5. Пользователь вводит код фильма
6. Бот ищет фильм по коду в базе данных и отправляет название фильма

## Алгоритм работы админ-панели

1. Администратор вводит команду `/admin`
2. Бот проверяет права администратора
3. Бот отображает админ-панель с доступными командами
4. Администратор выбирает нужную команду:
   - `/add_movie` - Бот запрашивает код и название фильма
   - `/list_movies` - Бот отправляет список всех фильмов
   - `/delete_movie` - Бот запрашивает код фильма для удаления
   - `/broadcast` - Бот запрашивает текст для рассылки
